import type { Metadata } from "next"
import { Nunito, Big_Shoulders_Display } from "next/font/google"
import "./globals.css"
import { getAuthenticatedAppForUser } from "@/lib/firebase/serverApp"
import { initFirebase } from "@/lib/firebase/initFirebase"
import FirebaseAuth from "./firebaseAuth"
import { User } from "firebase/auth"
import { Navbar, NavbarBrand, NavbarContent, NavbarItem, NavbarMenuToggle } from "@heroui/navbar"
import Link from "next/link"
import { Providers } from "./providers"
import WithAuth from "./withAuthServer"
initFirebase()

const sansFont = Nunito({
  variable: "--font-sans",
  weight: "variable",
  subsets: ["latin"],
})

const headingFont = Big_Shoulders_Display({
  variable: "--font-heading",
  weight: "800",
  subsets: ["latin"]
})

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
}

export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {

  const { currentUser } = await getAuthenticatedAppForUser()
  return (
    <html lang="en">
      <body className={`${sansFont.variable} ${headingFont.variable}`}>
        <Providers>
          <div className="relative flex flex-col h-screen">
            <Navbar isBordered isBlurred className="bg-background/100 dark:bg-background/10 text-white backdrop-blur-lg">
              <NavbarBrand>
                <img src="https://vcgh.co.uk/wp-content/uploads/2025/04/VCGH-white.svg" alt="Logo" width="150" />
              </NavbarBrand>
              <NavbarContent className="hidden sm:flex gap-4 font-black" justify="center">
                <NavbarItem>
                  <Link href="/">Events</Link>
                </NavbarItem>
                <WithAuth role="leader">
                  <NavbarItem>
                    <Link href="/create">Post a ride</Link>
                  </NavbarItem>
                </WithAuth>
              </NavbarContent>
              <NavbarContent justify="end">
                <FirebaseAuth initialUser={currentUser?.toJSON() as User} />
                <NavbarMenuToggle className="sm:hidden" aria-controls="basic-navbar-nav" />
              </NavbarContent>
            </Navbar>
            <main className="flex-1 container mx-auto px-4 py-8">
              {children}
            </main>
          </div>
        </Providers>
      </body>
    </html>
  )
}


